#!/bin/bash

GIT_ROOT=$(git rev-parse --show-toplevel)

if [ -f "$GIT_ROOT/pom.xml" ] && command -v mvn &> /dev/null; then
    if ! mvn test; then
        echo "Maven tests failed. Aborting git push."
        exit 1
    fi
elif [ -f "$GIT_ROOT/build.gradle" ] && command -v gradle &> /dev/null; then
    if ! gradle test; then
        echo "Gradle tests failed. Aborting git push."
        exit 1
    fi
fi

git push
exit 0
