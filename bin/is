#!/bin/bash

SEARCH=$*

JSON=$(ddgr "$SEARCH" --json)

URL=$(echo $JSON | jq -r '.[0].url')
TITLE=$(echo $JSON | jq '.[0].title')

HTML=$(curl -s GET "$URL" -A "Mozilla/5.0 (compatible;  MSIE 7.01; Windows NT 5.0)")

if [[ $URL =~ "en.wikipedia.org" ]]; then
    HTML=$(echo $HTML | htmlq 'p')
fi

if [[ $URL =~ "www.baeldung.com" ]]; then
    HTML=$(echo $HTML | htmlq '.post-content')
fi

if [[ $URL =~ "www.w3schools.com" ]]; then
    HTML=$(echo $HTML | htmlq '#main')
fi

if [[ $URL =~ "linuxhandbook.com" ]]; then
    HTML=$(echo $HTML | htmlq 'article')
fi

if [[ $URL =~ "stackoverflow.com" ]]; then
    HTML=$(echo $HTML | htmlq '.js-post-body, .user-details, .comment-body')
fi

if [[ $URL =~ "github.com" ]]; then
    HTML=$(echo $HTML | htmlq '.markdown-body')
fi

echo $HTML | pandoc -f html -t ansi | bat --file-name "$TITLE ($URL)" --style 'header,grid'
